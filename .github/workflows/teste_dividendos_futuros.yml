name: Testar Dividendos Futuros v2

on:
  workflow_dispatch:

jobs:
  testar:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Instalar dependÃªncias
        run: pip install pandas requests
      
      - name: Testar dividendos futuros
        run: |
          python src/capturar_dividendos_futuros.py --modo lista --lista "PETR4,VALE3,ITUB4,BBAS3,TAEE11,BBSE3,BBDC4,EGIE3"
      
      - name: Mostrar agenda consolidada
        run: |
          echo "=========================================="
          echo "AGENDA CONSOLIDADA"
          echo "=========================================="
          
          if [ -f "balancos/agenda_dividendos.json" ]; then
            # Mostrar apenas meta e prÃ³ximos eventos
            python3 << 'EOF'
          import json
          with open('balancos/agenda_dividendos.json', 'r') as f:
              data = json.load(f)
          
          print("\nðŸ“Š META:")
          for k, v in data.get('meta', {}).items():
              print(f"  {k}: {v}")
          
          print("\nðŸ“… PRÃ“XIMOS 7 DIAS COM EVENTOS:")
          for dia in data.get('calendario_30_dias', [])[:7]:
              if dia.get('tem_evento'):
                  print(f"  {dia['data_br']} ({dia['dia_semana']}): {dia['quantidade']} eventos - {dia['tickers']}")
          
          print("\nðŸ”® PRÃ“XIMOS EVENTOS:")
          for evento in data.get('proximos_eventos', [])[:10]:
              print(f"  {evento.get('data_ex')} | {evento.get('ticker'):8} | R$ {evento.get('valor', 0):.4f} | {evento.get('tipo', '')}")
          EOF
          else
            echo "âš ï¸ Agenda nÃ£o gerada"
          fi
      
      - name: Listar arquivos gerados
        run: |
          echo ""
          echo "=========================================="
          echo "ARQUIVOS GERADOS"
          echo "=========================================="
          find balancos -name "*.json" -o -name "*.csv" | head -20
