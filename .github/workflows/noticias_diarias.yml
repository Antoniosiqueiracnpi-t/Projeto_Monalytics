name: Atualização Diária de Notícias

on:
  schedule:
    - cron: '0 22 * * *'  # Todo dia às 22h UTC (19h Brasília)
  workflow_dispatch:
    inputs:
      dias:
        description: 'Dias retroativos (padrão: 1)'
        required: false
        default: '1'
        type: string

permissions:
  contents: write

jobs:
  noticias:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pandas finbr
      
      - name: Capturar Notícias do Dia
        run: |
          DIAS=${{ inputs.dias || '1' }}
          python src/capturar_noticias.py --modo quantidade --quantidade 0 --dias ${DIAS}
      
      - name: Commit e push
        run: |
          git config user.name "actions-user"
          git config user.email "actions-user@users.noreply.github.com"
          
          if [ -z "$(git status --porcelain)" ]; then
            echo "✅ Nenhuma notícia nova"
            exit 0
          fi
          
          git add balancos/*/noticias.json
          git commit -m "Notícias diárias: $(date +'%Y-%m-%d')"
          git push
